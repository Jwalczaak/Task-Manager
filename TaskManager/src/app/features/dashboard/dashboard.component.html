<div class="tasks-container">
  <p-table
    #dt2
    [value]="tasks() || []"
    dataKey="id"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [loading]="loading()"
    [paginator]="true"
    [globalFilterFields]="['title', 'assigned', 'status']"
    [tableStyle]="{ 'min-width': '75rem' }"
  >
    <ng-template #caption>
      <div class="flex">
        <p-iconfield iconPosition="left" class="ml-auto">
          <div class="actions flex flex-row justify-content-between">
            <p-inputicon>
              <i class="pi pi-search"></i>
            </p-inputicon>
            <input
              #globalFilter
              pInputText
              type="text"
              (input)="dt2.filterGlobal(globalFilter.value, 'contains')"
              placeholder="Search keyword"
            />

            <p-button label="Create" (click)="openModal('create', null)" />
          </div>
        </p-iconfield>
      </div>
    </ng-template>

    <ng-template #header>
      <tr>
        <th>Title</th>
        <th>Assigned</th>
        <th>Status</th>
        <th>Progress</th>

        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template #body let-task>
      <tr>
        <td>{{ task.title }}</td>
        <td>
          @for(assigned of task.assigned; track assigned.value) {<span>{{
            assigned.value
          }}</span
          >}
        </td>
        <td>
          <p-tag
            [value]="task.status"
            [severity]="getSeverity(task.status)"
          ></p-tag>
        </td>
        <td>{{ task.progressPercentage }}%</td>

        <td>
          <p-button
            icon="pi pi-pencil"
            aria-label="Save"
            (click)="openModal('update', task)"
          />
        </td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="5">No tasks found.</td>
      </tr>
    </ng-template>
  </p-table>
  @if(showModal()){
  <div class="form-container mt-4">
    <app-generic-modal
      [headerText]="'Create new task'"
      [width]="'900px'"
      [height]="'600px'"
      [contentComponent]="GenericFormComponent"
      [contentInputs]="{ config: currentFormConfig() }"
      (closeModal)="onHandleCloseModal()"
    ></app-generic-modal>
  </div>
  }
</div>
